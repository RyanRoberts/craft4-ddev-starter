{# @param entry Entry the content component entry #}
{# Alternatively, individual parameters can be passed. #}

{% if entry is defined %}
    {% set title = entry.title %}
    {% set criteria = entry.criteria.value|json_decode %}
    {% set buttons = entry.buttons.collect|map(button => {
        url: button.target.one.url ?? '',
        caption: button.caption ?? button.target.one.title ?? 'Read more'|t,
        primary: button.primary
    }) %}
{% endif %}

{# Defaults #}
{% set buttons = buttons ?? [] %}

{% set showMetaData = false %}
{% set layout = 'card' %}
{% set width = 'xl' %}

{% if criteria.showMetaData is defined %}
    {% set showMetaData = criteria.showMetaData %}
    {% set criteria = criteria|filter((v, k) => k != 'showMetaData') %}
{% endif %}

{% if criteria.layout is defined %}
    {% set layout = criteria.layout %}
    {% set criteria = criteria|filter((v, k) => k != 'layout') %}
{% endif %}

{% if criteria.width is defined %}
    {% set width = criteria.width %}
    {% set criteria = criteria|filter((v, k) => k != 'width') %}
{% endif %}


{% embed "_layouts/embeds/content-#{width}.twig" with {showHeader: false} %}
    {% block content %}
        {% include '_layouts/partials/cards.twig' with {
            query: craft.entries(criteria),
            heading: title,
            showMetaData: showMetaData,
            layout: layout
        } only %}

        {% include '_layouts/partials/heroarea/_ctabuttons.twig' with {
            buttons,
            classes: 'mt-8'
        } only %}
        
    {% endblock %}
{% endembed %}

{# Select data for hero area and invoke display #}

{# @param entry Entry set by Craft #}

{% if entry.showHeroArea %}
    {# 1. the entry itself  #}

    {% include '_layouts/partials/hero-area-display.twig' with {
        image: entry.featuredImage.one ?? siteInfo.featuredImage.one,
        title: entry.title,
        text: entry.tagline,
        template: entry.heroAreaTemplate
    } only %}
{% else %}
    {# 2. Hero entry #}

    {% set heroEntry = entry.heroArea ? entry.heroArea.one : null %}

    {% set teaser = '' %}

    {% if heroEntry %}

        {% if craft.app.request.isPreview and currentUser %}
            {% set draft = craft.entries.draftOf(heroEntry.id).provisionalDrafts(true).draftCreator(currentUser).one %}
            {% if draft %}
                {% set heroEntry = draft %}
            {% endif %}
        {% endif %}

        {% if heroEntry.section.handle == 'heroArea' %}
            {% set image =  heroEntry.heroImage.one %}
            {% set ctaButtons = heroEntry.ctaButtons.collect %}

            {% include '_layouts/partials/hero-area-display.twig' with {
                image,
                title: heroEntry.title,
                text: heroEntry.heroText,
                teaser: heroEntry.heroTeaser,
                buttons: ctaButtons|map(button => {
                    url: button.ctaTarget.one.url ?? '',
                    caption: button.ctaCaption ?? button.ctaTarget.one.title ?? 'Read more'|t,
                    text: button.ctaTarget.one.tagline ?? '',
                    primary: button.primary
                }),
                template: heroEntry.heroAreaTemplate
            } only %}
        {% else %}
            {% include "_layouts/contentsections/#{heroEntry.type.handle}.twig" with {
                entry: heroEntry
            } only %}
        {% endif %}
    {% endif %}
{% endif %}

{# Displays card with image/title/url and content block  #}

{# @param entry Element optional if title/url specified #}
{# @param title String Card Title optional if entry is specified #}
{# @param url String Card href optional if entry is specified #}
{# @param image Asset optional #}
{# @param highlight String string for text fragmant highlighting #}
{# @param layout String card|cardlet #}

{% set highlight = highlight ?? '' %}
{% set layout = layout ?? 'card' %}

{% from '_layouts/macros/lib.twig' import img %}

{% if entry is defined %}
    {% set title = title ?? entry.title %}
    {% set url = url ?? entry.url %}
    {% set image = image ?? entry.featuredImage.one ?? null %}
{% endif %}


{% if highlight %}
    {% set url = url ~ '#:~:text=' ~ highlight|replace({'"': ''})|e('url') %}
{% endif %}

{% set transform = transform ?? craft.app.config.custom.cardTransform %}

{% set classes = {
    card: {
        a: 'border border-gray-200 shadow-xl',
        imgDiv: '',
        textDiv: 'p-4'
    },
    cardlet:  {
        a: 'flex space-x-4',
        imgDiv: 'flex-shrink-0 w-36 sm:w-52',
        textDiv: ''
    }
} %}

<a href="{{ url }}" class="{{ classes[layout].a }} group overflow-hidden focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-primary-dark  rounded-lg">
    <div class="{{ classes[layout].imgDiv }} bg-gray-200 rounded-lg overflow-hidden">
        {% if image %}
            {{ img(image, {
                transform: transform,
                attr: {
                    class: "group-hover:opacity-75 group-focus:opacity-75 transition duration-300"
                }
            }) }}
        {% endif %}
    </div>

    <div class="{{ classes[layout].textDiv }}">
        <div class="text-lg font-bold text-primary dark:text-primary-dark group-hover:underline group-focus:underline">
            {{ title }}
        </div>

        {% block content %}{% endblock %}

        {% if entry.searchScore  is defined %}
            <!-- Score: {{ entry.searchScore  }} -->
        {% endif %}
    </div>

</a>